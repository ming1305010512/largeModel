## 1. 创建图谱

```
(课程)-[:BELONG]->(学科)-[:BELONG]->(分类)
(价格)<-[:HAVE]-(课程)-[:HAVE]->(教师)
(课程)<-[:BELONG]-(试卷)<-[:BELONG]-(试题)
(course)-[:HAVE]->(concept)
(chapter)-[:HAVE]->(concept)
```

## 2. 使用UIE对章节名称和课程介绍抽取知识点

## 3. 创建全文索引和向量索引

```
class IndexUtil:
    def __init__(self):
        self.graph = Neo4jGraph(
            url=NEO4J_CONFIG["uri"],
            username=NEO4J_CONFIG["auth"][0],
            password=NEO4J_CONFIG["auth"][1],
        )
        # 嵌入模型
        self.embedding_model = HuggingFaceEmbeddings(
            model_name="BAAI/bge-base-zh-v1.5",
            encode_kwargs={'normalize_embeddings': True},
        )
    # 创建全文索引
    def create_fulltext_index(self,index_name,label,property):
        cypher = f"""
                    create fulltext index {index_name} if not exists
                    for (n: {label}) on each [n.{property}] 
                """
        self.graph.query(cypher)

    def create_vector_index(self,index_name,label,source_property,embedding_property):
        # 生成嵌入向量并添加到节点属性中
        embedding_dim = self._add_embedding(label,source_property,embedding_property)
        cypher = f"""
            create vector index {index_name} if not exists
            for (n: {label}) on n.{embedding_property}
            options {{
                `vector.dimensions`: {embedding_dim},
                `vector.similarity_function`: 'cosine'
            }}
        """
        self.graph.query(cypher)

    # 生成嵌入向量并添加到节点属性中,返回向量维度
    def _add_embedding(self,label,source_property,embedding_property):
        # 1. 查询所有节点对应的原属性值，作为模型的输入
        cypher =f"""
            match (n: {label}) 
            return n.{source_property} as text,id(n) as id
        """
        results = self.graph.query(cypher)
        # 2. 获取查询结果中的文本内容
        docs = [result["text"] for result in results]

        # 3. 调用嵌入模型，得到嵌入向量
        embeddings = self.embedding_model.embed_documents(docs)
        # 4. 将id和嵌入向量组合成字典形式
        batch = []
        for result,embedding in zip(results,embeddings):
            batch.append({"id": result['id'], "embedding": embedding})
        # 5. 执行cypher,按id查节点，写入新的嵌入向量属性
        cypher = f"""
            unwind $batch as item
            match (n:{label})
            where id(n) = item.id
            set n.{embedding_property} = item.embedding
        """
        self.graph.query(cypher, params={'batch': batch})

        return len(embeddings[0])
```

## 4. 
