[TOC]

这是**序列标注（NER）里最基础、也最重要的概念之一**

------

## 结论

- **BIO / BIES** 是**给每个字（或 token）打“它在实体里的位置”**的一套规则
- 它们解决的是：
  👉 *“这个字是不是实体？如果是，它在实体的哪里？”*

------

## 一、先不讲字母，先讲“位置”

假设一句地址里有一个实体：

> **“浙江省”**（省名）

它由 3 个字组成：
`浙 / 江 / 省`

那每个字在这个实体里，都有一个**位置角色**：

- 第一个字：实体开始
- 中间的字：实体中间
- 最后一个字：实体结束

BIO / BIES 就是把这些“位置角色”编码成标签。

------

## 二、BIO 是什么？

**BIO = Begin / Inside / Outside**

| 标签      | 含义                 |
| --------- | -------------------- |
| **B-xxx** | 实体开始             |
| **I-xxx** | 实体内部（非第一个） |
| **O**     | 不属于任何实体       |

### 示例（BIO）

句子：

> 浙江省杭州市

标签（以“省 / 市”为实体类型）：

| 字   | 标签   |
| ---- | ------ |
| 浙   | B-prov |
| 江   | I-prov |
| 省   | I-prov |
| 杭   | B-city |
| 州   | I-city |
| 市   | I-city |

👉 BIO **没有明确的“结束”标志**，实体什么时候结束，是靠下一个 `O` 或 `B-xxx` 来判断的。

------

## 三、BIES 是什么？（比 BIO 更精细）

**BIES = Begin / Inside / End / Single**

| 标签      | 含义     |
| --------- | -------- |
| **B-xxx** | 实体开始 |
| **I-xxx** | 实体中间 |
| **E-xxx** | 实体结束 |
| **S-xxx** | 单字实体 |
| **O**     | 非实体   |

### 示例 1：多字实体

> 浙江省

| 字   | 标签   |
| ---- | ------ |
| 浙   | B-prov |
| 江   | I-prov |
| 省   | E-prov |

### 示例 2：单字实体（BIES 的优势）

> 湘（湖南简称）

| 字   | 标签   |
| ---- | ------ |
| 湘   | S-prov |

👉 **BIO 无法优雅表达“单字实体”**
👉 **BIES 天然支持单字实体**

------

## 四、你现在用的其实是 **BIE（少了 S）**

你现在的数据长这样（我简化一下）：

```json
"text":   ["浙","江","杭","州","市"]
"labels": ["B-prov","E-prov","B-city","I-city","E-city"]
```

这说明你用的是：

- **B**：开始
- **I**：中间
- **E**：结束
- ❌ 没有 **S**

### 这会有什么问题？

**单字实体不好处理**

比如：

- “湘”（省）
- “京”（北京市简称）
- “A栋”“B区”

你只能：

- 勉强标成 `B-xxx` 或 `E-xxx`
- 语义不完整，但还能跑

👉 所以你现在的方案**能用，但不完美**。

------

## 五、为什么大家常说 “BIO / BIES + CRF 更稳”

因为这些标签体系本质上是**状态机**：

### 合法转移（例子）

- `B-city → I-city → E-city`
- `O → B-prov`
- `S-prov → O`

### 非法转移（不该出现）

- `I-city → B-prov`
- `E-city → I-city`
- `I-city → I-prov`

CRF 可以**显式学习这些转移规则**，而 BIO/BIES 提供了“规则空间”。

👉 这也是为什么你现在讨论的
**“subtoken 重复监督 / 边界冲突”**
在 **BIES + CRF** 里会被放大。

------

## 六、结合你当前项目，直接给你建议

### 当前阶段（你现在）

- ✔ 保持 **B/I/E**
- ✔ **只给首 subtoken 打标签，其余 `-100`**
- ✔ 不加 CRF，先把流程跑通

### 下一阶段（你想更规范、更强）

- 🔁 把 **BIE → BIES**
- 🔁 加 `S-xxx`（单字实体）
- 🔁 上 **BERT + CRF**

我可以帮你做的：

- 自动把你现有 BIE 数据 **升级成 BIES**
- 写一个 **标签合法性检查器**（提前发现脏标注）
- 帮你把 CRF 无缝接进现在这套训练循环

------

## 七、一句“记忆版总结”

- **BIO**：简单，但不区分结尾
- **BIES**：最完整，最适合中文地址
- **你现在**：BIE（能跑，但单字实体不优雅）
- **subtoken 对齐**：位置标签 ≠ token 数量 → 所以只监督首 subtoken