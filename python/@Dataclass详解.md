[TOC]



------

## ğŸ§  ä¸€ã€ä»€ä¹ˆæ˜¯ `@dataclass`ï¼Ÿ

`@dataclass` æ˜¯ Python 3.7 å¼•å…¥çš„ä¸€ä¸ªè£…é¥°å™¨ï¼Œæ¥è‡ª `dataclasses` æ ‡å‡†åº“æ¨¡å—ã€‚

å®ƒçš„ä¸»è¦ç”¨é€”æ˜¯ï¼š

> âœ… **è‡ªåŠ¨ç”Ÿæˆç±»çš„å¸¸ç”¨æ–¹æ³•ï¼ˆå¦‚ `__init__`ã€`__repr__`ã€`__eq__` ç­‰ï¼‰**ï¼Œä½¿ä½ æ›´æ–¹ä¾¿åœ°åˆ›å»ºâ€œåªç”¨äºå­˜æ•°æ®â€çš„ç±»ã€‚

------

## ğŸ¯ äºŒã€ä¸ºä»€ä¹ˆä½¿ç”¨ `@dataclass`ï¼Ÿ

ä¼ ç»Ÿå†™æ³•å®šä¹‰ä¸€ä¸ªç®€å•æ•°æ®ç±»ï¼ˆå¦‚ç”¨æˆ·ä¿¡æ¯ï¼‰ï¼š

```python
class User:
    def __init__(self, name, age):
        self.name = name
        self.age = age

    def __repr__(self):
        return f"User(name={self.name}, age={self.age})"
```

å¤ªç¹çï¼è€Œä½¿ç”¨ `@dataclass`ï¼š

```python
from dataclasses import dataclass

@dataclass
class User:
    name: str
    age: int
```

è‡ªåŠ¨å¸®ä½ ç”Ÿæˆï¼š

- `__init__`
- `__repr__`
- `__eq__`
- ç”šè‡³æ”¯æŒæ’åºç­‰

ğŸŒŸ **ç®€æ´ï¼æ¸…æ™°ï¼å¼ºå¤§ï¼**

------

## ğŸ› ï¸ ä¸‰ã€åŸºæœ¬è¯­æ³•

```python
from dataclasses import dataclass

@dataclass
class ç±»å:
    å±æ€§1: ç±»å‹
    å±æ€§2: ç±»å‹ = é»˜è®¤å€¼ï¼ˆå¯é€‰ï¼‰
```

å±æ€§å¿…é¡»ä½¿ç”¨**ç±»å‹æ³¨è§£**ï¼ˆ`x: int`ï¼‰ï¼Œæ‰èƒ½è¢« dataclass æ­£å¸¸è¯†åˆ«ã€‚

------

## âœ… å››ã€è‡ªåŠ¨ç”Ÿæˆçš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ

é»˜è®¤è‡ªåŠ¨ç”Ÿæˆï¼š

| æ–¹æ³•å                                 | ä½œç”¨                 |
| -------------------------------------- | -------------------- |
| `__init__`                             | æ„é€ æ–¹æ³•             |
| `__repr__`                             | å­—ç¬¦ä¸²è¡¨ç¤º           |
| `__eq__`                               | ç›¸ç­‰åˆ¤æ–­             |
| `__hash__`                             | å“ˆå¸Œå€¼ï¼ˆå¯é€‰ï¼‰       |
| `__lt__`, `__le__`, `__gt__`, `__ge__` | æ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆéœ€è®¾ç½®ï¼‰ |

------

## ğŸ›ï¸ äº”ã€å¸¸ç”¨å‚æ•°ï¼ˆåœ¨è£…é¥°å™¨ä¸­è®¾ç½®ï¼‰

```python
@dataclass(init=True, repr=True, eq=True, order=False, frozen=False)
```

| å‚æ•°     | é»˜è®¤    | è¯´æ˜                                                |
| -------- | ------- | --------------------------------------------------- |
| `init`   | `True`  | æ˜¯å¦è‡ªåŠ¨ç”Ÿæˆ `__init__()`                           |
| `repr`   | `True`  | æ˜¯å¦è‡ªåŠ¨ç”Ÿæˆ `__repr__()`                           |
| `eq`     | `True`  | æ˜¯å¦è‡ªåŠ¨ç”Ÿæˆ `__eq__()`                             |
| `order`  | `False` | æ˜¯å¦æ”¯æŒæ’åºï¼ˆç”Ÿæˆ `< <= > >=`ï¼‰                    |
| `frozen` | `False` | æ˜¯å¦ä¸å¯å˜ï¼ˆç”Ÿæˆåªè¯»ç±»ï¼Œç›¸å½“äº `__setattr__` é”å®šï¼‰ |

------

## ğŸŒ° å…­ã€å®ä¾‹è®²è§£

```python
from dataclasses import dataclass

@dataclass
class Point:
    x: int
    y: int = 0

p1 = Point(1, 2)
p2 = Point(1)
print(p1)       # Point(x=1, y=2)
print(p2)       # Point(x=1, y=0)
print(p1 == p2) # False
```

------

## ğŸ§Š ä¸ƒã€ä¸å¯å˜ dataclassï¼ˆfrozenï¼‰

```python
@dataclass(frozen=True)
class Config:
    host: str
    port: int

cfg = Config("localhost", 8080)
cfg.port = 3306  # âŒ æŠ¥é”™ï¼šFrozenInstanceError
```

------

## ğŸ”ƒ å…«ã€æ’åºæ¯”è¾ƒï¼ˆorder=Trueï¼‰

```python
@dataclass(order=True)
class Score:
    name: str
    score: int

a = Score("Alice", 90)
b = Score("Bob", 85)
print(a > b)  # Trueï¼ˆé»˜è®¤æŒ‰å­—æ®µé¡ºåºæ¯”è¾ƒï¼‰
```

------

## ğŸ ä¹ã€é…åˆ `field()` æ§åˆ¶å­—æ®µè¡Œä¸º

`field()` å¯ç”¨äºè®¾ç½®é»˜è®¤å€¼ã€æ’é™¤å‚ä¸æ¯”è¾ƒ/æ˜¾ç¤ºã€æä¾›å…ƒæ•°æ®ç­‰ã€‚

```python
from dataclasses import dataclass, field

@dataclass
class Product:
    name: str
    price: float = 0.0
    secret: str = field(default="hidden", repr=False, compare=False)
```

------

## ğŸ§± åã€ä¸æ™®é€šç±»å¯¹æ¯”æ€»ç»“

| åŠŸèƒ½         | æ™®é€šç±»             | `@dataclass` |
| ------------ | ------------------ | ------------ |
| å†™èµ·æ¥       | å†—é•¿               | ç®€æ´         |
| è‡ªåŠ¨æ„é€ å‡½æ•° | âŒ                  | âœ…            |
| è‡ªåŠ¨æ¯”è¾ƒ     | âŒ                  | âœ…            |
| æ”¯æŒä¸å¯å˜   | æ‰‹å†™ `__setattr__` | âœ…            |
| æ”¯æŒæ’åº     | æ‰‹å†™æ¯”è¾ƒæ–¹æ³•       | âœ…            |
| ç±»å‹æ£€æŸ¥æ”¯æŒ | å¯é€‰               | å¼ºåˆ¶æ³¨è§£     |

------

## ğŸ§  åä¸€ã€åº•å±‚åŸç†ç®€è¿°

`@dataclass` æ˜¯ä¸€ä¸ªè£…é¥°å™¨ï¼Œå®ƒåœ¨ä½ å®šä¹‰ç±»ä¹‹åä¼šâ€œåŠ¨æ€åœ°â€ç”Ÿæˆ `__init__`ã€`__repr__` ç­‰æ–¹æ³•ï¼Œç›´æ¥å†™å…¥åˆ°ç±»ä¸­ï¼Œç›¸å½“äºä½ æ‰‹åŠ¨å†™äº†è¿™äº›æ–¹æ³•ã€‚

ä½¿ç”¨ `__annotations__` å’Œ AST åˆ†æå­—æ®µ â†’ ä½¿ç”¨ `exec()` æ„é€ æ–¹æ³• â†’ attach åˆ°ç±»

------

## ğŸ“š åäºŒã€å¸¸è§å®æˆ˜åœºæ™¯

- é…ç½®ç±»ï¼š`@dataclass(frozen=True)`
- æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆDTOï¼‰ï¼š`@dataclass`
- è¡¨æ ¼æ•°æ®æ¨¡å‹ï¼ˆç»“åˆ `csv/json`ï¼‰
- ç®€å•çŠ¶æ€è®°å½•å™¨
- ç»“åˆ `typing.Optional` è¡¨ç¤ºå¯ç©ºå­—æ®µ

------

## âœ… æ€»ç»“ä¸€å¥è¯ï¼š

> `@dataclass` æ˜¯è®©ä½ ç”¨æœ€å°‘çš„ä»£ç ï¼Œåˆ›å»ºåŠŸèƒ½å¼ºå¤§ã€å¯æ¯”ã€å¯æ˜¾ç¤ºã€å¯æ’åºçš„æ•°æ®ç±»çš„å·¥å…·ï¼Œéå¸¸é€‚åˆç”¨æ¥æ„å»ºå„ç§è½»é‡æ•°æ®æ¨¡å‹ã€‚

