[TOC]



> 池化层通过对局部区域做“取最大值”或“取平均值”等操作，**实现下采样、降低特征图大小、增强模型鲁棒性**。

## 主要作用

| 功能                  | 说明                                                         |
| --------------------- | ------------------------------------------------------------ |
| **降维 & 减少计算量** | 通过下采样（缩小特征图尺寸），减少后续层的参数数量           |
| **增强鲁棒性**        | 提高模型对小幅度平移、旋转、噪声的容忍度                     |
| **防止过拟合**        | 通过聚合局部信息，减少过度精细的特征                         |
| **提取局部主特征**    | 聚焦“重要”的局部信号，忽略细枝末节（例如 max pooling 捕捉最显著信号） |

## 常见的池化方式

### 1. **最大池化（Max Pooling）✅ 最常见**

- 每个局部区域取最大值
- 保留**最强信号**

```
import torch.nn as nn
nn.MaxPool2d(kernel_size=2, stride=2)
```

| 2x2 窗口区域 | 最大值输出 |
| ------------ | ---------- |
| [[1, 5],     | → 5        |
| [2, 4]]      |            |

------

### 2. **平均池化（Average Pooling）**

- 每个区域取平均值
- 平滑特征图，更稳定，但可能丢掉尖锐特征

```
nn.AvgPool2d(kernel_size=2, stride=2)
```

------

### 3. **全局平均池化（Global Avg Pooling）**

- 每个通道取全图平均值 → 输出一个数
- 常用于 CNN 末尾替代全连接层（如 MobileNet、ResNet）

## 池化参数说明（以 MaxPool2d 为例）

```
MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)
```

### 1️⃣ `kernel_size`

> **窗口大小**：决定每次池化操作的感受野大小

- 可以是 `int`（表示正方形），或 `tuple`（表示高宽分别设置）
- 例如：
  - `kernel_size=2` → 每次看 `2×2` 区域
  - `kernel_size=(2, 3)` → 每次看 `2 行 × 3 列`

------

### 2️⃣ `stride`

> **滑动步长**：每次窗口移动的步幅（横竖方向）

- 默认是和 `kernel_size` 相同（即窗口不重叠）
- 你可以设定：
  - `stride=1` → 每一个像素滑动，结果更密集
  - `stride=2` → 每隔一格滑动，通常用于下采样

------

### 3️⃣ `padding`

> **边缘填充**：是否在输入边缘补零，使窗口可以“完整滑动”

- 默认是 `padding=0` → 不补零
- 设为 1 就会在四边各补一圈 0，使池化区域对齐得更整齐

⚠️ 注意：**padding 会影响输出大小计算**

------

### 4️⃣ `dilation`（🔍 很少用，但很重要）

> **窗口元素的间隔**（空洞池化）

- 和“空洞卷积”类似
- 控制“池化窗口内部的采样间距”

#### 🚀 举个例子：

- `kernel_size=2, dilation=1` → 正常池化窗口：

  ```
  [[x, x],
   [x, x]]
  ```

- `kernel_size=2, dilation=2` → 每个元素间隔一个像素：

  ```
  [[x,   _,   x],
   [_,   _,   _],
   [x,   _,   x]]
  ```

**效果**：感受野更大，但参数仍小；有时用于图像分割任务中对大区域的响应聚合

------

### 5️⃣ `ceil_mode`

> **控制输出尺寸计算方式：**

- 默认是 `ceil_mode=False` → 使用**向下取整**：
  $$
  \left\lfloor \frac{H + 2P - D(K - 1) - 1}{S} + 1 \right\rfloor
  $$

- 如果设为 `True` → 使用**向上取整（ceil）**：

#### 🧮 举个例子：

```
import torch.nn as nn

m1 = nn.MaxPool2d(kernel_size=2, stride=2, ceil_mode=False)
m2 = nn.MaxPool2d(kernel_size=2, stride=2, ceil_mode=True)
```

- 输入 `5×5`，不够整除
- `ceil_mode=False` → 输出为 `2×2`
- `ceil_mode=True` → 输出为 `3×3`

✅ 用于你**不希望丢掉边缘信息**时。

------

### 🎯 总结对照表

| 参数名        | 作用                 | 常用设置      | 特殊场景                     |
| ------------- | -------------------- | ------------- | ---------------------------- |
| `kernel_size` | 池化窗口大小         | 2 或 3        | 卷积感受野设置               |
| `stride`      | 滑动步长             | 通常设为2     | 可以为1做特征平滑            |
| `padding`     | 边缘补零             | 0（默认）     | 防止边界信息丢失             |
| `dilation`    | 池化窗口内部采样间隔 | 1（默认）     | 空洞池化，扩大感受野         |
| `ceil_mode`   | 是否向上取整输出尺寸 | False（默认） | 输入尺寸不能整除时保边缘区域 |

## 池化前后尺寸关系

设输入尺寸 $H_{in} \times W_{in}$，输出尺寸计算为：
$$
H_{out} = \left\lfloor \frac{H_{in} + 2P - K}{S} + 1 \right\rfloor
$$

- $K$：kernel_size
- $S$：stride
- $P$：padding

------

### 示例：MaxPool 操作

输入图像（通道数=1）大小：`4x4`
 使用 `kernel_size=2, stride=2` 的 MaxPool

#### 输入：

```
[[1, 3, 2, 1],
 [4, 6, 5, 0],
 [2, 9, 3, 4],
 [0, 1, 7, 2]]
```

#### 过程（分块）：

1. 左上：`[[1,3],[4,6]]` → max=6
2. 右上：`[[2,1],[5,0]]` → max=5
3. 左下：`[[2,9],[0,1]]` → max=9
4. 右下：`[[3,4],[7,2]]` → max=7

#### 输出：

```
[[6, 5],
 [9, 7]]
```

## 为什么 Max Pooling 有用？

- 可以认为它是“提取最显著特征”的操作，**让网络只关注强响应区域**
- 比如图像中“边缘、纹理、角点”等重要区域在卷积后表现为高值，max pooling 把它保留下来

------

## 池化 vs 卷积的区别

| 特性         | 卷积层                 | 池化层                 |
| ------------ | ---------------------- | ---------------------- |
| 是否有参数   | ✅ 有（可训练）         | ❌ 无（固定计算）       |
| 是否变换通道 | ✅ 一般会改变通道数     | ❌ 通道数保持不变       |
| 核心作用     | 提取特征，产生新图     | 下采样，缩小特征图尺寸 |
| 是否可逆     | ✅ 有转置卷积可近似还原 | ❌ 信息丢失，不可逆     |

------

## 总结

| 项目     | 内容                                      |
| -------- | ----------------------------------------- |
| 核心目标 | 下采样、聚合特征、增强平移不变性          |
| 常见方式 | Max Pooling、Avg Pooling、Global Avg Pool |
| 参数     | kernel_size、stride、padding等            |
| 模型位置 | 常放在卷积层后，用于缩小尺寸              |